<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Xiaoniao Settings</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <h1 class="title">
          <svg class="icon-logo" width="24" height="24" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" fill="currentColor" opacity="0.2"/>
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z" fill="currentColor"/>
          </svg>
          Xiaoniao
        </h1>
        <div class="toggle-container">
          <label class="toggle">
            <input type="checkbox" id="extensionToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      <p class="subtitle">Type translation for real-time chat</p>
    </header>

    <!-- Translation Mode -->
    <section class="section">
      <h2 class="section-title">Translation Mode</h2>
      <div class="mode-selector">
        <button class="mode-btn active" data-mode="builtin">
          <div class="mode-icon">‚ú®</div>
          <div class="mode-info">
            <div class="mode-name">Built-in AI</div>
            <div class="mode-desc">Free & Private (Gemini Nano)</div>
          </div>
        </button>
        <button class="mode-btn" data-mode="openrouter">
          <div class="mode-icon">üåê</div>
          <div class="mode-info">
            <div class="mode-name">OpenRouter</div>
            <div class="mode-desc">Gemini 2.5 Flash via OpenRouter</div>
          </div>
        </button>
        <button class="mode-btn" data-mode="gemini">
          <div class="mode-icon">üöÄ</div>
          <div class="mode-info">
            <div class="mode-name">Gemini API</div>
            <div class="mode-desc">Direct Gemini 2.5 Flash</div>
          </div>
        </button>
      </div>
    </section>

    <!-- API Key (show when OpenRouter or Gemini mode) -->
    <section class="section api-key-section" id="apiKeySection" style="display: none;">
      <h2 class="section-title" id="apiKeyTitle">API Key</h2>
      <div class="input-group">
        <input
          type="password"
          id="apiKeyInput"
          class="input"
          placeholder="Enter your API key"
        >
        <button id="testApiKey" class="btn btn-secondary">Test</button>
      </div>
      <p class="hint" id="apiKeyHint">
        Get your free API key from
        <a href="https://ai.google.dev" target="_blank" id="apiKeyLink">ai.google.dev</a>
      </p>
    </section>

    <!-- Prompt Selection -->
    <section class="section">
      <h2 class="section-title">Translation Style</h2>
      <div class="prompt-list" id="promptList">
        <!-- Populated by JavaScript -->
      </div>
      <button id="addCustomPrompt" class="btn btn-secondary btn-full">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Add Custom Style
      </button>
    </section>

    <!-- Built-in AI Warning (hidden by default) -->
    <section class="section" id="builtinAIWarning" style="display: none;">
      <div class="warning-card">
        <div style="font-size: 20px; margin-bottom: 8px;">‚ö†Ô∏è</div>
        <h3 style="margin: 0 0 8px 0; font-size: 14px; font-weight: 600;">Chrome Built-in AI Not Available</h3>
        <p style="margin: 0 0 12px 0; font-size: 13px; color: #666; line-height: 1.5;">
          To use Built-in AI mode, please enable these flags in Chrome:
        </p>
        <ol style="margin: 0 0 12px 0; padding-left: 20px; font-size: 12px; color: #666; line-height: 1.6;">
          <li>Open <code>chrome://flags/#optimization-guide-on-device-model</code></li>
          <li>Set to "Enabled BypassPerfRequirement"</li>
          <li>Open <code>chrome://flags/#prompt-api-for-gemini-nano</code></li>
          <li>Set to "Enabled"</li>
          <li>Restart Chrome</li>
        </ol>
        <p style="margin: 0; font-size: 12px; color: #999;">
          Or switch to OpenRouter/Gemini API mode above.
        </p>
      </div>
    </section>

    <!-- Status -->
    <section class="section">
      <div class="status-card">
        <div class="status-indicator">
          <div class="status-dot" id="statusDot"></div>
          <span class="status-text" id="statusText">Ready</span>
        </div>
        <p class="status-desc">Copy any text and it will be translated automatically</p>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <p class="footer-text">
        Made with ‚ù§Ô∏è for seamless communication
      </p>
    </footer>
  </div>

  <script type="module" src="popup.js"></script>
</body>
</html>
